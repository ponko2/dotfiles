#!/usr/bin/env bash

set -euxo pipefail

if command -v darwin-rebuild >/dev/null; then
  # Nix
  nix flake update --flake ~/dotfiles
  nh darwin switch
  /bin/ls -dt1 /nix/var/nix/profiles/system-*-link | /usr/bin/head -2 | /usr/bin/tail -r | xargs nix store diff-closures
else
  # Homebrew
  brew update --auto-update
  brew upgrade --fetch-HEAD
fi

# Sheldon
sheldon lock --update

# Neovim
nvim --headless "+Lazy! update" +qa
